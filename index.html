<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horario - Kingston Academy</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
</head>
<body>
<div class="container mt-4">
    <h2 class="text-center mb-3">üìö Horario de Clases - Kingston Academy</h2>

    <!-- Formulario para agregar clases -->
    <div class="card p-3 mb-4">
        <form id="formHorario">
            <div class="row mb-3">
                <div class="col-md-3">
                    <label>D√≠a</label>
                    <select class="form-select" id="dia" required>
                        <option value="">Seleccionar...</option>
                        <option>Lunes</option>
                        <option>Martes</option>
                        <option>Mi√©rcoles</option>
                        <option>Jueves</option>
                        <option>Viernes</option>
                        <option>S√°bado</option>
                        <option>Domingo</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label>Inicio</label>
                    <input type="time" class="form-control" id="horaInicio" required>
                </div>
                <div class="col-md-2">
                    <label>Fin</label>
                    <input type="time" class="form-control" id="horaFin" required>
                </div>
                <div class="col-md-5">
                    <label>Asignatura</label>
                    <input type="text" class="form-control" id="materia" required>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-4">
                    <label>Sede - Aula</label>
                    <input type="text" class="form-control" id="sede" placeholder="Ej: PRINCIPAL - 101" required>
                </div>
                <div class="col-md-4">
                    <label>Curso</label>
                    <input type="text" class="form-control" id="curso" placeholder="Ej: DCB-G1" required>
                </div>
                <div class="col-md-4">
                    <label>Docente</label>
                    <input type="text" class="form-control" id="docente" required>
                </div>
            </div>
            <button type="submit" class="btn btn-primary w-100">‚ûï Agregar Clase</button>
        </form>
    </div>

    <!-- Botones de acciones -->
    <button id="btnPDF" class="btn btn-success mb-2 w-100">üì• Descargar Horario en PDF</button>
    <button id="btnBorrar" class="btn btn-danger mb-4 w-100">üóëÔ∏è Borrar Horario</button>

    <!-- Tabla de horario en pantalla -->
    <div class="card p-3">
        <table class="table table-bordered text-center" id="tablaHorario">
            <thead>
                <tr>
                    <th>Lunes</th>
                    <th>Martes</th>
                    <th>Mi√©rcoles</th>
                    <th>Jueves</th>
                    <th>Viernes</th>
                    <th>S√°bado</th>
                    <th>Domingo</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="Lunes"></td>
                    <td id="Martes"></td>
                    <td id="Mi√©rcoles"></td>
                    <td id="Jueves"></td>
                    <td id="Viernes"></td>
                    <td id="S√°bado"></td>
                    <td id="Domingo"></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
// === VARIABLES ===
const form = document.getElementById("formHorario");
const btnPDF = document.getElementById("btnPDF");
const btnBorrar = document.getElementById("btnBorrar");
const dias = ["Lunes","Martes","Mi√©rcoles","Jueves","Viernes","S√°bado","Domingo"];

// === Cargar horario al iniciar ===
document.addEventListener("DOMContentLoaded", () => {
    if (localStorage.getItem("horario")) {
        const data = JSON.parse(localStorage.getItem("horario"));
        dias.forEach(dia => {
            document.getElementById(dia).textContent = data[dia] || "";
        });
    }
});

// === Guardar horario en LocalStorage ===
function guardarHorario() {
    let horario = {};
    dias.forEach(dia => {
        horario[dia] = document.getElementById(dia).textContent;
    });
    localStorage.setItem("horario", JSON.stringify(horario));
}

// === Agregar clase ===
form.addEventListener("submit", e => {
    e.preventDefault();

    const dia = document.getElementById("dia").value;
    const inicio = document.getElementById("horaInicio").value;
    const fin = document.getElementById("horaFin").value;
    const materia = document.getElementById("materia").value;
    const sede = document.getElementById("sede").value;
    const curso = document.getElementById("curso").value;
    const docente = document.getElementById("docente").value;

    let celda = document.getElementById(dia);
    celda.textContent += `Horario: ${inicio} - ${fin}\nSede - Aula: ${sede}\nAsignatura: ${materia}\nCurso: ${curso}\nDocente: ${docente}\n\n`;

    guardarHorario();
    form.reset();
});

// === Borrar horario completo ===
btnBorrar.addEventListener("click", () => {
    if (confirm("¬øSeguro que deseas borrar todo el horario?")) {
        dias.forEach(dia => {
            document.getElementById(dia).textContent = "";
        });
        localStorage.removeItem("horario");
    }
});

// === Descargar PDF ===
btnPDF.addEventListener("click", () => {
    let tablaFilas = "<tr>";
    dias.forEach(dia => {
        tablaFilas += `<td>${document.getElementById(dia).textContent.replace(/\n/g, "<br>")}</td>`;
    });
    tablaFilas += "</tr>";

    const contenidoPDF = `
    <div style="font-family: Arial; padding:15px;">
        <div style="text-align:center; font-weight:bold; font-size:18px; border-bottom:2px solid #000; padding-bottom:8px;">
            KINGSTON ACADEMY<br>HORARIOS ESTUDIANTE
        </div>
        <div style="display:flex; justify-content:space-between; font-size:13px; margin-top:5px; margin-bottom:5px;">
            <div><b>Estudiante:</b> Andres Felipe Abril Lopez</div>
            <div><b>Fecha de generaci√≥n:</b> ${new Date().toLocaleDateString()}</div>
        </div>
        <table border="1" style="width:100%; border-collapse:collapse; font-size:11px; text-align:left;">
            <thead>
                <tr>
                    <th>Lunes</th>
                    <th>Martes</th>
                    <th>Mi√©rcoles</th>
                    <th>Jueves</th>
                    <th>Viernes</th>
                    <th>S√°bado</th>
                    <th>Domingo</th>
                </tr>
            </thead>
            <tbody>${tablaFilas}</tbody>
        </table>
    </div>`;

    let pdfArea = document.createElement("div");
    pdfArea.innerHTML = contenidoPDF;
    document.body.appendChild(pdfArea);

    html2pdf().from(pdfArea).set({
        margin: 0.3,
        filename: 'Horario_Kingston_Academy.pdf',
        image: { type: 'jpeg', quality: 1 },
        html2canvas: { scale: 2, letterRendering: true, useCORS: true },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'landscape' }
    }).save()
      .then(() => {
        setTimeout(() => document.body.removeChild(pdfArea), 500);
    })
      .catch(err => console.error("Error al generar PDF:", err));
});
</script>
</body>
</html>
